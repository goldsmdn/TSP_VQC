

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>modules.helper_functions_tsp &mdash; Travelling Salesman Problem 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Travelling Salesman Problem
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">modules package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../classes.html">classes package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Travelling Salesman Problem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">modules.helper_functions_tsp</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for modules.helper_functions_tsp</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graycode</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">count</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit.circuit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit</span><span class="w"> </span><span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">transpile</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_aer</span><span class="w"> </span><span class="kn">import</span> <span class="n">AerSimulator</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_ibm_runtime.fake_provider</span><span class="w"> </span><span class="kn">import</span> <span class="n">FakeAuckland</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_aer.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">SamplerV2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span> <span class="c1"># Import Callable for type hinting</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">modules.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">NETWORK_DIR</span><span class="p">,</span> 
                            <span class="n">DATA_SOURCES</span><span class="p">,</span> 
                            <span class="n">PRINT_FREQUENCY</span><span class="p">,</span>
                            <span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">classes.LRUCacheUnhashable</span><span class="w"> </span><span class="kn">import</span> <span class="n">LRUCacheUnhashable</span>

<div class="viewcode-block" id="load_dict_from_json">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.load_dict_from_json">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_dict_from_json</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads a dictionary from a JSON file&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_index">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.read_index">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_index</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads CSV file and returns a dictionary</span>
<span class="sd">     </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The filename of the CSV file.  </span>
<span class="sd">    encoding : str</span>
<span class="sd">        The expected coding.  If this is missed </span>
<span class="sd">        get odd charactors at start of the file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict : dict</span>
<span class="sd">        A dictionary with the contents on the CSV file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
        <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
            <span class="nb">dict</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">row</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_file_name">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.read_file_name">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_file_name</span><span class="p">(</span><span class="n">locations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                   <span class="n">data_sources</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                   <span class="n">file_type</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;file&#39;</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the filename for a certain number of locations</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    locations : int</span>
<span class="sd">        Number of locations, or vertices</span>
<span class="sd">    data_sources : dict</span>
<span class="sd">        Dictionary listing the filename for each problem size</span>
<span class="sd">    source : str</span>
<span class="sd">        Source of data - only sim has </span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : string</span>
<span class="sd">        The filename for that problem size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">data_sources</span><span class="p">[</span><span class="n">locations</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading distance data&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">data_sources</span><span class="p">[</span><span class="n">locations</span><span class="p">][</span><span class="s1">&#39;points&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading co-ordinate data&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File type </span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s1"> is not coded for&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>       </div>


<div class="viewcode-block" id="validate_distance_array">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.validate_distance_array">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_distance_array</span><span class="p">(</span><span class="n">array</span> <span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">locs</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates the distance array and raises an Exception if the </span>
<span class="sd">    array is not valid.  Checks the array is the correct shape, and</span>
<span class="sd">    is symmetric</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : array</span>
<span class="sd">        Numpy symmetric array with distances</span>
<span class="sd">    locs : int</span>
<span class="sd">        Number of locations or vertices</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">array</span><span class="p">))</span> <span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The distance array is not two dimensional&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">array</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">!=</span> <span class="n">locs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The shape of the array does not match </span><span class="si">{</span><span class="n">locs</span><span class="si">}</span><span class="s1"> locations&#39;</span><span class="p">)</span>
    <span class="c1">#check symmetry</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">locs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">locs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The array is not symmetrical&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_distance">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.find_distance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_distance</span><span class="p">(</span><span class="n">loc1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                  <span class="n">loc2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                  <span class="n">distance_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the distance between locations using the distance matrix</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loc1 : int</span>
<span class="sd">        First location</span>
<span class="sd">    loc2 : int</span>
<span class="sd">        Second location</span>
<span class="sd">    distance_array : np.ndarray</span>
<span class="sd">        An array containing the distances between locations</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        If True then more information is printed</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    distance : Float</span>
<span class="sd">        The distance between two locations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">distance</span> <span class="o">=</span> <span class="n">distance_array</span><span class="p">[</span><span class="n">loc1</span><span class="p">][</span><span class="n">loc2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The distance from location </span><span class="si">{</span><span class="n">loc1</span><span class="si">}</span><span class="s1"> to location </span><span class="si">{</span><span class="n">loc2</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_bin_length">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.find_bin_length">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_bin_length</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;find the length of a binary string to represent integer i&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n must be a positive integer&quot;</span><span class="p">)</span>
    <span class="n">bin_len</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">bin_len</span><span class="p">)</span> </div>


<div class="viewcode-block" id="find_problem_size">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.find_problem_size">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_problem_size</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the number of binary variables needed</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl: sub data logger containing fields</span>
<span class="sd">        sdl.locations : int </span>
<span class="sd">            Number of locations</span>
<span class="sd">        sdl.formulation:</span>
<span class="sd">            &#39;original&#39; =&gt; method from Goldsmith D, Day-Evans J.</span>
<span class="sd">            &#39;new&#39; =&gt; method from Schnaus M, Palackal L, Poggel B, Runge X, Ehm H, Lorenz JM, et al.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    pb_dim : int</span>
<span class="sd">        Length of the bit string needed to store the problem</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">formulation</span> <span class="o">==</span> <span class="s1">&#39;original&#39;</span><span class="p">:</span>
        <span class="n">pb_dim</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">):</span>
            <span class="n">bin_len</span> <span class="o">=</span> <span class="n">find_bin_length</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">pb_dim</span> <span class="o">+=</span> <span class="n">bin_len</span>
    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">formulation</span> <span class="o">==</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">)</span>
        <span class="n">pb_dim</span> <span class="o">=</span> <span class="n">find_bin_length</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown method </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">formulation</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pb_dim</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_binary_list_to_integer">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.convert_binary_list_to_integer">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_binary_list_to_integer</span><span class="p">(</span><span class="n">binary_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">gray</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts list of binary numbers to an integer</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    binary_list : list</span>
<span class="sd">        List of binary numbers</span>
<span class="sd">    gray : bool</span>
<span class="sd">        Determines whether gray code is used.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    result : int</span>
<span class="sd">        The integer represented by the concatenated binary string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">binary_list</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">result</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gray</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">graycode</span><span class="o">.</span><span class="n">gray_code_to_tc</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_integer_to_binary_list">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.convert_integer_to_binary_list">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_integer_to_binary_list</span><span class="p">(</span><span class="n">integer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">gray</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts an integer to a list of binary numbers</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    integer : int</span>
<span class="sd">        The integer to be converted</span>
<span class="sd">    length : int</span>
<span class="sd">        The length of the binary string</span>
<span class="sd">    gray : bool</span>
<span class="sd">        If True Gray codes are used</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    result : list</span>
<span class="sd">        A list of binary numbers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">gray</span><span class="p">:</span>
        <span class="n">integer</span> <span class="o">=</span> <span class="n">graycode</span><span class="o">.</span><span class="n">tc_to_gray_code</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
    <span class="n">binary_string</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
    <span class="n">binary_string</span> <span class="o">=</span> <span class="n">binary_string_format</span><span class="p">(</span><span class="n">binary_string</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">binary_string</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_loc_list">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.check_loc_list">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">check_loc_list</span><span class="p">(</span><span class="n">loc_list</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">locs</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks that the location list is a valid cycle with no repetition of nodes.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loc_list : list</span>
<span class="sd">        A list of locations with a length one less than the number of locations in the problem</span>
<span class="sd">    locs : int</span>
<span class="sd">        The total number of locations in the problem</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    valid : Boolean</span>
<span class="sd">        Whether the loc_list is a valid cycle</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">loc_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">locs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">locs</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">locs</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">loc_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">loc_list</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="augment_loc_list">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.augment_loc_list">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">augment_loc_list</span><span class="p">(</span><span class="n">loc_list</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">locs</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Completes the cycle by adding the missing location to the end of the cycle.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loc_list : list</span>
<span class="sd">        A list of locations with a length one less than the number of locations in the problem</span>
<span class="sd">    locs : int</span>
<span class="sd">        The total number of locations in the problem</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    valid : loc_list</span>
<span class="sd">        The original location list with the missing node list added to the end of the cycle</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">full_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">locs</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">full_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loc_list</span><span class="p">:</span>
            <span class="n">add_item</span> <span class="o">=</span> <span class="n">item</span>
    <span class="n">loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_item</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">loc_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_total_distance">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.find_total_distance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_total_distance</span><span class="p">(</span><span class="n">int_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> 
                        <span class="n">locs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                        <span class="n">distance_array</span> <span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
                        <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the total distance for a valid formatted bit string representing a cycle.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    int_list : list of integers</span>
<span class="sd">        A list representing a valid cycle</span>
<span class="sd">    locs: int</span>
<span class="sd">        The number of locations</span>
<span class="sd">    distance_array : array</span>
<span class="sd">        Numpy symmetric array with distances between locations</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    total_distance : float</span>
<span class="sd">        The total distance for the cycle represented by that integer list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">int_list</span><span class="p">)</span> <span class="o">!=</span> <span class="n">locs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The list supplied has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">int_list</span><span class="p">)</span><span class="si">}</span><span class="s1"> entries and </span><span class="si">{</span><span class="n">locs</span><span class="si">}</span><span class="s1"> are expected&#39;</span><span class="p">)</span>

    <span class="n">total_distance</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">locs</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">locs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1">#complete cycle</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unexpected values of i in loop&#39;</span><span class="p">)</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">find_distance</span><span class="p">(</span><span class="n">int_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">int_list</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">distance_array</span><span class="p">)</span>
        <span class="n">total_distance</span> <span class="o">+=</span> <span class="n">distance</span>
    <span class="k">return</span> <span class="n">total_distance</span></div>


<div class="viewcode-block" id="cost_fn_fact">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.cost_fn_fact">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cost_fn_fact</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> <span class="n">distance_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">list</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns a cost function inside a decorator,</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl: SubDataLogger object containing key parameters:</span>
<span class="sd">        sdl.locations: int</span>
<span class="sd">            The number of locations in the problem</span>
<span class="sd">        sdl.gray: bool</span>
<span class="sd">            If True Gray codes are used</span>
<span class="sd">        sdl.formulation: str</span>
<span class="sd">            &#39;original&#39; =&gt; method from Goldsmith D, Day-Evans J.</span>
<span class="sd">            &#39;new&#39; =&gt; method from Schnaus M, Palackal L, Poggel B, Runge X, Ehm H, Lorenz JM, et al.</span>
<span class="sd">    distance_array: array</span>
<span class="sd">        Numpy symmetric array with distances between locations</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cost_fn: cost function</span>
<span class="sd">        A function of a bit string evaluating a distance for that bit string</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@LRUCacheUnhashable</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cost_fn</span><span class="p">(</span><span class="n">bit_string_input</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the value of the objective function for a bit_string&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit_string_input</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">bit_string</span> <span class="o">=</span> <span class="n">bit_string_input</span>
            <span class="n">full_list_of_locs</span> <span class="o">=</span> <span class="n">convert_bit_string_to_cycle</span><span class="p">(</span><span class="n">bit_string</span><span class="p">,</span> 
                                                            <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">,</span> 
                                                            <span class="n">sdl</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span> 
                                                            <span class="n">sdl</span><span class="o">.</span><span class="n">formulation</span>
                                                            <span class="p">)</span>
            <span class="n">total_distance</span> <span class="o">=</span> <span class="n">find_total_distance</span><span class="p">(</span><span class="n">full_list_of_locs</span><span class="p">,</span> 
                                                 <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">,</span> 
                                                 <span class="n">distance_array</span>
                                                 <span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">check_loc_list</span><span class="p">(</span><span class="n">full_list_of_locs</span><span class="p">,</span>
                                   <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span>
                                   <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Algorithm returned incorrect cycle&#39;</span><span class="p">)</span>  
            <span class="k">return</span> <span class="n">total_distance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bit_string </span><span class="si">{</span><span class="n">bit_string_input</span><span class="si">}</span><span class="s1"> is not a list or a tensor&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cost_fn</span></div>


<div class="viewcode-block" id="cost_fn_tensor">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.cost_fn_tensor">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cost_fn_tensor</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">,</span> 
                   <span class="n">cost_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; Find the distance for each bit string input using cost_fn</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input : torch.tensor</span>
<span class="sd">        Torch array with n bit strings for analysis</span>
<span class="sd">    cost_fn : function</span>
<span class="sd">        maps a bit_list to a distance</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    distance_tensor : torch.tensor</span>
<span class="sd">        a Torch array with one distance entry for each input</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;input= </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s1"> is a Torch tensor but does not have dimension 2&#39;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">distance_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">bit_string</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">cost_fn</span><span class="p">(</span><span class="n">bit_string</span><span class="p">)</span>
            <span class="n">distance_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="k">return</span> <span class="n">distance_tensor</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bit_string </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s1"> is not a tensor&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="convert_bit_string_to_cycle">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.convert_bit_string_to_cycle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_bit_string_to_cycle</span><span class="p">(</span><span class="n">bit_string</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> 
                                <span class="n">locs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                                <span class="n">gray</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a bit string to a cycle.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bit_string : list</span>
<span class="sd">        A list of zeros and ones produced by the quantum computer</span>
<span class="sd">    locs: int</span>
<span class="sd">        The number of locations</span>
<span class="sd">    gray: bool</span>
<span class="sd">        If True Gray codes are used</span>
<span class="sd">    method: str</span>
<span class="sd">        &#39;original&#39; =&gt; method from Goldsmith D, Day-Evans J. </span>
<span class="sd">        &#39;new&#39; =&gt; method from Schnaus M, Palackal L, Poggel B, Runge X, Ehm H, Lorenz JM, et al.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    end_cycle_list : list</span>
<span class="sd">        A list of integers showing a cycle.  The bit string is processed from left to right</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">end_cycle_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_cycle_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">locs</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;original&#39;</span><span class="p">:</span>
        <span class="c1">#need to avoid changing the original bit_string</span>
        <span class="n">bit_string_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">bit_string</span><span class="p">)</span>
        <span class="n">end_cycle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_cycle_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="c1">#end point of cycle is always 0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">locs</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">bin_len</span> <span class="o">=</span> <span class="n">find_bin_length</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">bin_string</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bin_len</span><span class="p">):</span>
                <span class="n">bin_string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bit_string_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="c1">#pop the most left hand item</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">convert_binary_list_to_integer</span><span class="p">(</span><span class="n">bin_string</span><span class="p">,</span> <span class="n">gray</span><span class="o">=</span><span class="n">gray</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">position</span> <span class="o">%</span> <span class="n">i</span>    
            <span class="n">end_cycle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_cycle_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">end_cycle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_cycle_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">start_cycle_list</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cycle returned may not be complete&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bit_string_copy</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bit_string not consumed </span><span class="si">{</span><span class="n">bit_string_copy</span><span class="si">}</span><span class="s1"> left&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">end_cycle_list</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
        <span class="n">bit_string_length</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bit_string</span><span class="p">)</span> <span class="o">!=</span> <span class="n">bit_string_length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bit_string length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">bit_string</span><span class="p">)</span><span class="si">}</span><span class="s1"> does not match </span><span class="si">{</span><span class="n">bit_string_length</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">convert_binary_list_to_integer</span><span class="p">(</span><span class="n">bit_string</span><span class="p">,</span> <span class="n">gray</span><span class="o">=</span><span class="n">gray</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="n">f</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">locs</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">locs</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
            <span class="c1">#correcting mistype in paper</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">end_cycle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_cycle_list</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">start_cycle_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">start_cycle_list</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="c1">#correcting mistype in paper</span>
            <span class="n">y</span> <span class="o">-=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">f</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">end_cycle_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_stats">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.find_stats">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_stats</span><span class="p">(</span><span class="n">cost_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
               <span class="n">counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> 
               <span class="n">shots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
               <span class="n">average_slice</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
               <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the average energy of the relevant counts, and the lowest energy</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cost_fn: function</span>
<span class="sd">        A function of a bit string evaluating an energy(distance) for that bit string</span>
<span class="sd">    counts : dict</span>
<span class="sd">        Dictionary holding the binary string and the counts observed</span>
<span class="sd">    shots: integer</span>
<span class="sd">        number of shots</span>
<span class="sd">    average_slice: float</span>
<span class="sd">        average over this slice of the energy.  eg</span>
<span class="sd">        If average_slice = 1 then average over all energies.  </span>
<span class="sd">        If average_slice = 0.2 then average over the bottom 20% of energies</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    average : float</span>
<span class="sd">        The average energy</span>
<span class="sd">    lowest_dist : float</span>
<span class="sd">        The lowest energy</span>
<span class="sd">    lowest_energy_bit_string: list</span>
<span class="sd">        A list of the bits for the lowest energy bit string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">average_slice</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The average_slice must be less or equal to 1, not </span><span class="si">{</span><span class="n">average_slice</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">average_slice</span> <span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The average_slice must be greater than zero, not </span><span class="si">{</span><span class="n">average_slice</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">average_slice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">slicing</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slicing</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">total_counts</span><span class="p">,</span> <span class="n">total_energy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">slicing</span><span class="p">:</span>
        <span class="n">energy_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">bit_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="k">for</span> <span class="n">bits</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">cost_fn</span><span class="p">(</span><span class="n">bit_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slicing</span><span class="p">:</span>
            <span class="c1">#if already in dictionary increment</span>
            <span class="k">if</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">energy_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">energy_dict</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">+=</span><span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">energy_dict</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">=</span><span class="n">count</span>
        <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">lowest_energy</span> <span class="o">=</span> <span class="n">energy</span>
            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">lowest_energy_bit_string</span> <span class="o">=</span> <span class="n">bit_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">energy</span> <span class="o">&lt;</span> <span class="n">lowest_energy</span><span class="p">:</span>
                <span class="n">lowest_energy</span> <span class="o">=</span> <span class="n">energy</span>
                <span class="n">lowest_energy_bit_string</span> <span class="o">=</span> <span class="n">bit_list</span>
        <span class="n">total_counts</span> <span class="o">+=</span> <span class="n">count</span>
        <span class="n">total_energy</span> <span class="o">+=</span> <span class="n">energy</span> <span class="o">*</span> <span class="n">count</span>

    <span class="k">if</span> <span class="n">shots</span> <span class="o">!=</span> <span class="n">total_counts</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The total_counts </span><span class="si">{</span><span class="n">total_counts</span><span class="si">=}</span><span class="s1"> does not agree to the </span><span class="si">{</span><span class="n">shots</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">slicing</span><span class="p">:</span>
        <span class="n">accum</span><span class="p">,</span> <span class="n">total_energy</span><span class="p">,</span> <span class="n">total_counts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">shots</span> <span class="o">*</span> <span class="n">average_slice</span>
        <span class="n">sorted_energy_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">energy_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">energy</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">sorted_energy_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">accum</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">accum</span> <span class="o">+</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
                    <span class="n">total_energy</span> <span class="o">+=</span> <span class="n">energy</span> <span class="o">*</span> <span class="n">count</span>
                    <span class="n">total_counts</span> <span class="o">+=</span> <span class="n">count</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">total_counts</span> <span class="o">+=</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">accum</span>
                    <span class="n">total_energy</span> <span class="o">+=</span> <span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">accum</span><span class="p">)</span>
            <span class="n">accum</span> <span class="o">+=</span> <span class="n">count</span>
    <span class="n">average_energy</span> <span class="o">=</span> <span class="n">total_energy</span> <span class="o">/</span> <span class="n">total_counts</span>

    <span class="k">return</span><span class="p">(</span><span class="n">average_energy</span><span class="p">,</span> <span class="n">lowest_energy</span><span class="p">,</span> <span class="n">lowest_energy_bit_string</span><span class="p">)</span></div>


<div class="viewcode-block" id="hot_start">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.hot_start">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hot_start</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> <span class="n">distance_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds a route from a distance array where the distance to the next point is the shortest available</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl : SubDataLogger object containing key parameters:</span>
<span class="sd">        sdl.locations: int</span>
<span class="sd">            The number of locations in the problem</span>
<span class="sd">    distance_array: array</span>
<span class="sd">        Numpy symmetric array with distances between locations</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    end_cycle_list: list</span>
<span class="sd">        A list of integers showing the an estimate of the lowest cycle</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">validate_distance_array</span><span class="p">(</span><span class="n">distance_array</span><span class="p">,</span> <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">)</span>
    <span class="n">remaining_cycle_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">)]</span>
    <span class="n">end_cycle_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">end_cycle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remaining_cycle_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="c1">#start point of cycle is always 0</span>
    <span class="n">next_row</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">remaining_cycle_list</span><span class="p">):</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">distance_array</span><span class="p">[</span><span class="n">next_row</span><span class="p">][</span><span class="n">column</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">arg_min</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">lowest_distance</span> <span class="o">=</span> <span class="n">distance</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">lowest_distance</span><span class="p">:</span>
                    <span class="n">arg_min</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="n">lowest_distance</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="n">next_row</span> <span class="o">=</span> <span class="n">remaining_cycle_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg_min</span><span class="p">)</span>
        <span class="n">end_cycle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_row</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">end_cycle_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="binary_string_format">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.binary_string_format">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">binary_string_format</span><span class="p">(</span><span class="n">binary_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_len</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format a binary string to remove the 0b prefix</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    binary_string : str</span>
<span class="sd">        A binary string</span>
<span class="sd">    bin_len : str</span>
<span class="sd">        Length of the binary string</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    formatted_string: str</span>
<span class="sd">        The binary string with the 0b prefix removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formatted_string</span> <span class="o">=</span> <span class="n">binary_string</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">formatted_string</span> <span class="o">=</span> <span class="n">formatted_string</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">bin_len</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">formatted_string</span><span class="p">)</span>    </div>

    
<div class="viewcode-block" id="hot_start_list_to_string">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.hot_start_list_to_string">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hot_start_list_to_string</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> <span class="n">hot_start_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Invert the hot start integer list into a string</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>

<span class="sd">    sdl : SubDataLogger object containing key parameters:</span>
<span class="sd">        sdl.locations: int </span>
<span class="sd">            The number of location in the problem</span>
<span class="sd">        sdl.gray: bool</span>
<span class="sd">            If True Gray codes are used</span>
<span class="sd">        sdl.formulation: str</span>
<span class="sd">            &#39;original&#39; =&gt; method from Goldsmith D, Day-Evans J.</span>
<span class="sd">            &#39;new&#39; =&gt; method from Schnaus M, Palackal L, Poggel B, Runge X, Ehm H, Lorenz JM, et al.</span>
<span class="sd">    hot_start_list: list</span>
<span class="sd">        A list of integers showing an estimate of the lowest cycle</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result_list: list</span>
<span class="sd">        A list of bits that represents the bit string for the lowest cycle</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">formulation</span> <span class="o">==</span> <span class="s1">&#39;original&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hot_start_list</span><span class="p">)</span> <span class="o">!=</span> <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The hot start list should be length </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="n">first_item</span> <span class="o">=</span> <span class="n">hot_start_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1">#remove the first item for the list which should be zero</span>
        <span class="k">if</span> <span class="n">first_item</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The first item of the list must be zero&#39;</span><span class="p">)</span>
        
        <span class="n">initial_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">)]</span>    
        <span class="n">total_binary_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">result_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">integer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hot_start_list</span><span class="p">):</span>
            <span class="n">bin_len</span> <span class="o">=</span> <span class="n">find_bin_length</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial_list</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">bin_len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#find the index of integer in hot start list</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">initial_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">gray</span><span class="p">:</span>
                    <span class="n">binary_string</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">graycode</span><span class="o">.</span><span class="n">tc_to_gray_code</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">binary_string</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">binary_string</span> <span class="o">=</span> <span class="n">binary_string_format</span><span class="p">(</span><span class="n">binary_string</span><span class="p">,</span> <span class="n">bin_len</span><span class="p">)</span>
                <span class="n">total_binary_string</span> <span class="o">+=</span> <span class="n">binary_string</span>
                <span class="n">initial_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">total_binary_string</span><span class="p">)):</span>
            <span class="n">result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">total_binary_string</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result_list</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">formulation</span> <span class="o">==</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">find_problem_size</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">start_cycle_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">)]</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">locations</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">hot_start_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">start_cycle_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">start_cycle_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>  
            <span class="n">y</span> <span class="o">+=</span> <span class="n">j</span> <span class="o">*</span> <span class="n">f</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">result_list</span> <span class="o">=</span> <span class="n">convert_integer_to_binary_list</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gray</span><span class="o">=</span><span class="n">sdl</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown method </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">formulation</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="validate_gradient_type">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.validate_gradient_type">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_gradient_type</span><span class="p">(</span><span class="n">gradient_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that the gradient type is valid&quot;&quot;&quot;</span>
    <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;parameter_shift&#39;</span><span class="p">,</span> <span class="s1">&#39;SPSA&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">gradient_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Gradient type </span><span class="si">{</span><span class="n">gradient_type</span><span class="si">}</span><span class="s1"> is not coded for&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="update_parameters_using_gradient">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.update_parameters_using_gradient">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_parameters_using_gradient</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                                     <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                     <span class="n">rots</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                     <span class="n">cost_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
                                     <span class="n">qc</span><span class="p">:</span> <span class="n">QuantumCircuit</span><span class="p">,</span>
                                     <span class="n">print_results</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates parameters using SPSA or parameter shift gradients&quot;&quot;&quot;</span>
    <span class="n">cost_list</span><span class="p">,</span> <span class="n">lowest_list</span><span class="p">,</span> <span class="n">index_list</span><span class="p">,</span> <span class="n">gradient_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">parameter_list</span><span class="p">,</span> <span class="n">average_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">validate_gradient_type</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">gradient_type</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">gradient_type</span> <span class="o">==</span> <span class="s1">&#39;SPSA&#39;</span><span class="p">:</span>
        <span class="c1">#define_parameters</span>
        <span class="c1"># A is &lt;= 10% of the number of iterations normally, but here the number of iterations is lower.</span>
        <span class="c1"># order of magnitude of first gradients</span>
        <span class="n">abs_gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">my_gradient</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> 
                                          <span class="n">cost_fn</span><span class="p">,</span> 
                                          <span class="n">qc</span><span class="p">,</span> 
                                          <span class="n">params</span><span class="p">,</span> 
                                          <span class="n">rots</span><span class="p">,</span> 
                                          <span class="n">average_slice</span><span class="o">=</span><span class="n">sdl</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span>
                                          <span class="p">)</span>
                                <span class="p">)</span>
        
        <span class="n">magnitude_g0</span> <span class="o">=</span> <span class="n">abs_gradient</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
 
        <span class="k">if</span> <span class="n">magnitude_g0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># stop div by zero error</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">sdl</span><span class="o">.</span><span class="n">eta</span><span class="o">*</span><span class="p">((</span><span class="n">sdl</span><span class="o">.</span><span class="n">big_a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">sdl</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">magnitude_g0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sdl</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">detect_quantum_GPU_support</span><span class="p">:</span>
            <span class="n">bc</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">assign_parameters</span><span class="p">({</span><span class="n">params</span><span class="p">:</span> <span class="n">rot</span> <span class="k">for</span> <span class="n">params</span><span class="p">,</span> <span class="n">rot</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">rots</span><span class="p">)})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bc</span> <span class="o">=</span> <span class="n">bind_weights</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">rots</span><span class="p">,</span> <span class="n">qc</span><span class="p">)</span>
        <span class="n">cost</span><span class="p">,</span> <span class="n">lowest</span><span class="p">,</span> <span class="n">lowest_energy_bit_string</span> <span class="o">=</span> <span class="n">cost_func_evaluate</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                                                                    <span class="n">cost_fn</span><span class="p">,</span> 
                                                                    <span class="n">bc</span><span class="p">,</span> 
                                                                    <span class="n">average_slice</span><span class="o">=</span> <span class="n">sdl</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span> 
                                                                    <span class="p">)</span>
        <span class="c1">#cost is the top-sliced energy</span>
        <span class="n">average</span><span class="p">,</span> <span class="n">_</span> <span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cost_func_evaluate</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                                            <span class="n">cost_fn</span><span class="p">,</span> 
                                            <span class="n">bc</span><span class="p">,</span> 
                                            <span class="n">average_slice</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                                            <span class="p">)</span>
        <span class="c1">#average is the average energy with no top slicing</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lowest_string_to_date</span> <span class="o">=</span> <span class="n">lowest_energy_bit_string</span>
            <span class="n">lowest_to_date</span> <span class="o">=</span> <span class="n">lowest</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lowest</span> <span class="o">&lt;</span> <span class="n">lowest_to_date</span><span class="p">:</span>
                <span class="n">lowest_to_date</span> <span class="o">=</span> <span class="n">lowest</span>
                <span class="n">lowest_string_to_date</span> <span class="o">=</span> <span class="n">lowest_energy_bit_string</span>
        <span class="n">route_list</span> <span class="o">=</span> <span class="n">convert_bit_string_to_cycle</span><span class="p">(</span><span class="n">lowest_string_to_date</span><span class="p">,</span> 
                                                 <span class="n">sdl</span><span class="o">.</span><span class="n">locations</span><span class="p">,</span> 
                                                 <span class="n">sdl</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span> 
                                                 <span class="n">sdl</span><span class="o">.</span><span class="n">formulation</span><span class="p">,</span>
                                                 <span class="p">)</span>
        <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">cost_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
        <span class="n">lowest_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lowest_to_date</span><span class="p">)</span>
        <span class="n">average_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">average</span><span class="p">)</span>
        <span class="n">parameter_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rots</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">gradient_type</span> <span class="o">==</span> <span class="s1">&#39;parameter_shift&#39;</span><span class="p">:</span>
            <span class="n">gradient</span> <span class="o">=</span> <span class="n">my_gradient</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> 
                                   <span class="n">cost_fn</span><span class="p">,</span> 
                                   <span class="n">qc</span><span class="p">,</span> 
                                   <span class="n">params</span><span class="p">,</span> 
                                   <span class="n">rots</span><span class="p">,</span> 
                                   <span class="n">average_slice</span><span class="o">=</span><span class="n">sdl</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span>
                                   <span class="p">)</span>
            
            <span class="n">rots</span> <span class="o">=</span> <span class="n">rots</span> <span class="o">-</span> <span class="n">sdl</span><span class="o">.</span><span class="n">eta</span> <span class="o">*</span> <span class="n">gradient</span>
        <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">gradient_type</span> <span class="o">==</span> <span class="s1">&#39;SPSA&#39;</span><span class="p">:</span>
            <span class="n">ak</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">sdl</span><span class="o">.</span><span class="n">big_a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">alpha</span><span class="p">))</span>
            <span class="n">ck</span> <span class="o">=</span> <span class="n">sdl</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">gamma</span><span class="p">))</span>
            <span class="n">gradient</span> <span class="o">=</span> <span class="n">my_gradient</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                                   <span class="n">cost_fn</span><span class="p">,</span> 
                                   <span class="n">qc</span><span class="p">,</span> 
                                   <span class="n">params</span><span class="p">,</span> 
                                   <span class="n">rots</span><span class="p">,</span> 
                                   <span class="n">average_slice</span><span class="o">=</span><span class="n">sdl</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span>
                                   <span class="n">ck</span><span class="o">=</span><span class="n">ck</span><span class="p">,</span>
                                   <span class="p">)</span>
            <span class="n">rots</span> <span class="o">=</span> <span class="n">rots</span> <span class="o">-</span> <span class="n">ak</span> <span class="o">*</span> <span class="n">gradient</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error found when calculating gradient. </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">gradient_type</span><span class="si">}</span><span class="s1"> is not an allowed gradient type&#39;</span><span class="p">)</span>
        <span class="n">gradient_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gradient</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">PRINT_FREQUENCY</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> using the best </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">average_slice</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1"> percent of the results&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The average cost from the sample is </span><span class="si">{</span><span class="n">average</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> and the top-sliced average of the best results is </span><span class="si">{</span><span class="n">cost</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The lowest cost from the sample is </span><span class="si">{</span><span class="n">lowest</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The lowest cost to date is </span><span class="si">{</span><span class="n">lowest_to_date</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> corresponding to bit string </span><span class="si">{</span><span class="n">lowest_string_to_date</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;and route </span><span class="si">{</span><span class="n">route_list</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index_list</span><span class="p">,</span> <span class="n">cost_list</span><span class="p">,</span> <span class="n">lowest_list</span><span class="p">,</span> <span class="n">gradient_list</span><span class="p">,</span> <span class="n">average_list</span><span class="p">,</span> <span class="n">parameter_list</span> </div>

    
<div class="viewcode-block" id="cost_func_evaluate">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.cost_func_evaluate">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cost_func_evaluate</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                       <span class="n">cost_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
                       <span class="n">model</span><span class="p">,</span>
                       <span class="n">average_slice</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>             
<span class="w">                       </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate cost function on a quantum computer</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl: SubDataLogger object containing key parameters:</span>
<span class="sd">        sdl.noise: bool</span>
<span class="sd">            If True a noisy quantum computer is used</span>
<span class="sd">        sdl.quantum: bool</span>
<span class="sd">            If True a quantum computer is used.  If False a classical model is used</span>
<span class="sd">        sdl.shots: int</span>
<span class="sd">            The number of shots for which the quantum circuit is to be run  </span>
<span class="sd">    cost_fn: function</span>
<span class="sd">        A function of a bit string evaluating a distance for that bit string</span>
<span class="sd">    model : a model to evalulate an output bit string given weights eg</span>
<span class="sd">        QuantumCircuit</span>
<span class="sd">            A quantum circuit with bound weights for which the energy is to be found</span>
<span class="sd">        Classical Model</span>
<span class="sd">            A classical model with bound weights for which the energy is to be found</span>
<span class="sd">    average_slice: float</span>
<span class="sd">        average over this slice of the energy.  For example:</span>
<span class="sd">        If average_slice = 1 then average over all energies.  </span>
<span class="sd">        If average_slice = 0.2 then average over the bottom 20% of energies</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cost: float</span>
<span class="sd">        The average cost evaluated</span>
<span class="sd">    lowest: float</span>
<span class="sd">        The lowest cost found</span>
<span class="sd">    lowest_energy_bit_string: string</span>
<span class="sd">        A list of the bits for the lowest energy bit string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">quantum</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">noise</span><span class="p">:</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">FakeAuckland</span><span class="p">()</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="n">sdl</span><span class="o">.</span><span class="n">shots</span><span class="p">)</span>     
            <span class="n">counts</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mps</span><span class="p">:</span>
            <span class="n">simulator</span> <span class="o">=</span> <span class="n">AerSimulator</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;matrix_product_state&#39;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">detect_quantum_GPU_support</span><span class="p">():</span>
                <span class="n">simulator</span> <span class="o">=</span> <span class="n">AerSimulator</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;statevector&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;GPU&#39;</span><span class="p">)</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">counts</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sampler</span> <span class="o">=</span> <span class="n">SamplerV2</span><span class="p">()</span>
                <span class="n">job</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">model</span><span class="p">],</span> <span class="n">shots</span><span class="o">=</span><span class="n">sdl</span><span class="o">.</span><span class="n">shots</span><span class="p">)</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">counts</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meas</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Classical model not yet coded for&#39;</span><span class="p">)</span>
    <span class="n">cost</span><span class="p">,</span> <span class="n">lowest</span><span class="p">,</span> <span class="n">lowest_energy_bit_string</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span><span class="n">cost_fn</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">sdl</span><span class="o">.</span><span class="n">shots</span><span class="p">,</span> <span class="n">average_slice</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">lowest</span><span class="p">,</span> <span class="n">lowest_energy_bit_string</span><span class="p">)</span></div>


<div class="viewcode-block" id="my_gradient">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.my_gradient">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">my_gradient</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                <span class="n">cost_fn</span><span class="p">,</span> 
                <span class="n">qc</span><span class="p">:</span><span class="n">QuantumCircuit</span><span class="p">,</span> 
                <span class="n">params</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> 
                <span class="n">rots</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                <span class="n">average_slice</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> 
                <span class="n">ck</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate gradient for a quantum circuit with parameters and rotations</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl: SubDataLogger object containing key parameters, for example:</span>
<span class="sd">        sdl.noise: bool</span>
<span class="sd">            If True a noisy quantum computer is used</span>
<span class="sd">        sdl.shots: int</span>
<span class="sd">            The number of shots for which the quantum circuit is to be run  </span>
<span class="sd">        sdl.s: float</span>
<span class="sd">            Parameter shift parameter</span>
<span class="sd">        sdl.gradient_type: str</span>
<span class="sd">            controls the optimiser to be used.</span>
<span class="sd">            if &#39;parameter shift&#39;  uses analytical expression</span>
<span class="sd">            if &#39;SPSA&#39; uses a stochastical method</span>
<span class="sd">        sdl.ck: float</span>
<span class="sd">            SPSA parameter, small number controlling perturbations</span>
<span class="sd">    cost_fn: function</span>
<span class="sd">        A function of a bit string evaluating an energy (distance) for that bit string</span>
<span class="sd">    qc: QuantumCircuit</span>
<span class="sd">        A quantum circuit for which the gradient is to be found, without the weights being bound</span>
<span class="sd">    params: list</span>
<span class="sd">        A list of parameters (the texts)</span>
<span class="sd">    rots: list</span>
<span class="sd">        The exact values for the parameters, which are rotations of quantum gates</span>
<span class="sd">    average_slice: float</span>
<span class="sd">        Controls the amount of data to be included in the average.  </span>
<span class="sd">        For example, 0.2 means that the lowest 20% of distances found is included in the average.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gradient:array</span>
<span class="sd">        The gradient for each parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_rots</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">rots</span><span class="p">)</span>  
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">gradient_type</span> <span class="o">==</span> <span class="s1">&#39;parameter_shift&#39;</span><span class="p">:</span>
        <span class="n">gradient_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">theta</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rots</span><span class="p">):</span>
            <span class="n">new_rots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">sdl</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
            <span class="n">bc</span> <span class="o">=</span> <span class="n">bind_weights</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">new_rots</span><span class="p">,</span> <span class="n">qc</span><span class="p">)</span>
            <span class="n">cost_plus</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cost_func_evaluate</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                                                 <span class="n">cost_fn</span><span class="p">,</span> 
                                                 <span class="n">bc</span><span class="p">,</span> 
                                                 <span class="n">average_slice</span><span class="p">,</span> 
                                                 <span class="p">)</span>
            
            <span class="n">new_rots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">sdl</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
            <span class="n">bc</span> <span class="o">=</span> <span class="n">bind_weights</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">new_rots</span><span class="p">,</span> <span class="n">qc</span><span class="p">)</span>
            <span class="n">cost_minus</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cost_func_evaluate</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                                                  <span class="n">cost_fn</span><span class="p">,</span> 
                                                  <span class="n">bc</span><span class="p">,</span> 
                                                  <span class="n">average_slice</span><span class="p">,</span> 
                                                  <span class="p">)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">sdl</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">cost_plus</span> <span class="o">-</span> <span class="n">cost_minus</span><span class="p">)</span>
            <span class="n">gradient_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">gradient_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gradient_list</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">gradient_type</span> <span class="o">==</span> <span class="s1">&#39;SPSA&#39;</span><span class="p">:</span>
        <span class="c1"># number of parameters</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rots</span><span class="p">)</span>
        <span class="c1"># bernoulli-like distribution</span>
        <span class="n">deltak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>
        
        <span class="c1"># simultaneous perturbations</span>
        <span class="n">ck_deltak</span> <span class="o">=</span> <span class="n">ck</span> <span class="o">*</span> <span class="n">deltak</span>
        <span class="n">new_rots</span> <span class="o">=</span> <span class="n">rots</span> <span class="o">+</span> <span class="n">ck_deltak</span>
        <span class="c1"># gradient approximation]</span>
        <span class="n">bc</span> <span class="o">=</span> <span class="n">bind_weights</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">new_rots</span><span class="p">,</span> <span class="n">qc</span><span class="p">)</span>
        <span class="n">cost_plus</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cost_func_evaluate</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                                             <span class="n">cost_fn</span><span class="p">,</span> 
                                             <span class="n">bc</span><span class="p">,</span> 
                                             <span class="n">average_slice</span><span class="p">,</span> 
                                             <span class="p">)</span>

        <span class="n">new_rots</span> <span class="o">=</span> <span class="n">rots</span> <span class="o">-</span> <span class="n">ck_deltak</span>
        <span class="n">bc</span> <span class="o">=</span> <span class="n">bind_weights</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">new_rots</span><span class="p">,</span> <span class="n">qc</span><span class="p">)</span>
        <span class="n">cost_minus</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cost_func_evaluate</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span>
                                              <span class="n">cost_fn</span><span class="p">,</span> 
                                              <span class="n">bc</span><span class="p">,</span> 
                                              <span class="n">average_slice</span><span class="p">,</span> 
                                              <span class="p">)</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="n">cost_plus</span> <span class="o">-</span> <span class="n">cost_minus</span>
        <span class="n">gradient_array</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ck_deltak</span><span class="p">)</span>
        <span class="c1">#need to return an array to match parameter shift</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Gradient type </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">gradient_type</span><span class="si">}</span><span class="s1"> is not an allowed choice&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gradient_array</span>   </div>

    
<div class="viewcode-block" id="define_parameters">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.define_parameters">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">define_parameters</span><span class="p">(</span><span class="n">sdl</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up parameters and initialise text</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl: MySubDataLogger</span>
<span class="sd">        A sub data logger holding the parameters for the run with key fields: </span>
<span class="sd">        sdl.qubits: int - The number of qubits in the circuit</span>
<span class="sd">        sdl.mode: int - Controls setting the circuit up in different modes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    params: list</span>
<span class="sd">        A list of parameters (the texts)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,]:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">num_params</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;param &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">params</span>
    <span class="k">else</span><span class="p">:</span>   
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s1"> has not been coded for&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="vqc_circuit">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.vqc_circuit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">vqc_circuit</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantumCircuit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up a variational quantum circuit</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl: MySubDataLogger</span>
<span class="sd">        A sub data logger holding the parameters for the run with key fields:</span>
<span class="sd">        sdl.qubits: int - The number of qubits in the circuit</span>
<span class="sd">        sdl.mode: int - Controls setting the circuit up in different modes</span>
<span class="sd">        sdl.noise: bool- Controls if noise is included in the circuit</span>
<span class="sd">    params: list</span>
<span class="sd">        A list of parameters (the texts)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    qc: Quantum Circuit</span>
<span class="sd">        A quantum circuit without bound weights</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">rxx</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">rxx</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,)</span>
    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">rzz</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">rzz</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
    <span class="c1">#test mode</span>
        <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;test mode </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s1"> is only to be used with 5 qubits.  </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="si">}</span><span class="s1"> qubits are specified&#39;</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="p">):</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s1"> has not been coded for&#39;</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">noise</span><span class="p">:</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">FakeAuckland</span><span class="p">()</span>
        <span class="n">qc</span><span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qc</span></div>


<div class="viewcode-block" id="create_initial_rotations">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.create_initial_rotations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_initial_rotations</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> <span class="n">bin_hot_start_list</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise parameters with random weights</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl : Subdata logger with fields:</span>
<span class="sd">        sdl.qubits : int</span>
<span class="sd">            The number of qubits in the circuit</span>
<span class="sd">        sdl.mode : int</span>
<span class="sd">            Controls setting the circuit up in different modes</span>
<span class="sd">        sdl.hot_start : bool</span>
<span class="sd">            If true hot start values are used</span>
<span class="sd">    bin_hot_start_list : list</span>
<span class="sd">        Binary list containing the hot start values</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    init_rots: array</span>
<span class="sd">        initial rotations</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,]:</span>
        <span class="n">param_num</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span> <span class="o">*</span> <span class="n">sdl</span><span class="o">.</span><span class="n">layers</span>
    <span class="k">elif</span> <span class="n">sdl</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">param_num</span> <span class="o">=</span> <span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span> <span class="o">*</span> <span class="n">sdl</span><span class="o">.</span><span class="n">layers</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s1"> is not yet coded&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">hot_start</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sdl</span><span class="o">.</span><span class="n">layers</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cannot use a hot start for mode </span><span class="si">{mode}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">init_rots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">param_num</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_hot_start_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">init_rots</span><span class="p">[</span><span class="n">sdl</span><span class="o">.</span><span class="n">qubits</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> 
                <span class="c1">#need to reverse order because of qiskit convention</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">init_rots</span><span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">param_num</span><span class="p">)]</span>
    <span class="n">init_rots_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">init_rots</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">init_rots_array</span><span class="p">)</span></div>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>

<div class="viewcode-block" id="bind_weights">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.bind_weights">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bind_weights</span><span class="p">(</span><span class="n">params</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">rots</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">qc</span><span class="p">:</span><span class="n">QuantumCircuit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantumCircuit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bind parameters to rotations and return a bound quantum circuit</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params: list</span>
<span class="sd">        A list of parameters (the texts)</span>
<span class="sd">    rots: list</span>
<span class="sd">        The exact values for the parameters, which are rotations of quantum gates</span>
<span class="sd">    qc: Quantum Circuit</span>
<span class="sd">        A quantum circuit without bound weights  </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bc: Quantum Circuit</span>
<span class="sd">        A quantum circuit with including bound weights, ready to run an evaluation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">binding_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rots</span><span class="p">):</span>
        <span class="n">binding_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="n">rot</span>
    <span class="n">bc</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">assign_parameters</span><span class="p">(</span><span class="n">binding_dict</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">bc</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_run_stats">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.find_run_stats">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_run_stats</span><span class="p">(</span><span class="n">lowest_list</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the lowest energy and the iteration at which it was found</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lowest_list: list</span>
<span class="sd">        A list of floats showing the lowest energy found at that iteration</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lowest_energy: float</span>
<span class="sd">        The lowest energy found</span>
<span class="sd">    iteration: int</span>
<span class="sd">        The iteration at which the lowest energy was found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">previous_lowest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lowest_list</span><span class="p">)</span>
    <span class="n">lowest_energy</span> <span class="o">=</span> <span class="n">previous_lowest</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lowest_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span>  <span class="n">previous_lowest</span><span class="p">:</span>
            <span class="n">lowest_energy</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">previous_lowest</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">iteration</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">lowest_energy</span><span class="p">,</span> <span class="n">iteration</span></div>


<div class="viewcode-block" id="find_distances_array">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.find_distances_array">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_distances_array</span><span class="p">(</span><span class="n">locations</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> 
                         <span class="n">print_comments</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the array of distances between locations and the best distance&quot;&quot;&quot;</span>
    <span class="n">sources_filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">NETWORK_DIR</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">DATA_SOURCES</span><span class="p">)</span>
    <span class="n">data_source_dict</span> <span class="o">=</span> <span class="n">load_dict_from_json</span><span class="p">(</span><span class="n">sources_filename</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">read_file_name</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">locations</span><span class="p">),</span> <span class="n">data_source_dict</span><span class="p">)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">NETWORK_DIR</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">best_dist</span> <span class="o">=</span> <span class="n">data_source_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">locations</span><span class="p">)][</span><span class="s1">&#39;best&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">print_comments</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data will be read from filename </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span> 
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;It is known that the shortest distance is </span><span class="si">{</span><span class="n">best_dist</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">distance_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">validate_distance_array</span><span class="p">(</span><span class="n">distance_array</span><span class="p">,</span> <span class="n">locations</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">distance_array</span><span class="p">,</span> <span class="n">best_dist</span></div>


<div class="viewcode-block" id="format_boolean">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.format_boolean">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">format_boolean</span><span class="p">(</span><span class="n">string_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a string to a boolean value&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">string_input</span> <span class="o">==</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">string_input</span> <span class="o">==</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unexpected boolean value </span><span class="si">{</span><span class="n">string_input</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span> </div>


<div class="viewcode-block" id="detect_quantum_GPU_support">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.detect_quantum_GPU_support">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">detect_quantum_GPU_support</span><span class="p">()</span><span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect if a GPU is available for quantum simulations&quot;&quot;&quot;</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="n">AerSimulator</span><span class="p">()</span><span class="o">.</span><span class="n">available_devices</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;GPU&#39;</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="calculate_hot_start_data">
<a class="viewcode-back" href="../../modules.html#modules.helper_functions_tsp.calculate_hot_start_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_hot_start_data</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> 
                             <span class="n">distance_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                             <span class="n">cost_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
                             <span class="n">print_results</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate hot start data from a distance array</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sdl : SubDataLogger object </span>
<span class="sd">        Containing key parameters</span>
<span class="sd">    distance_array: array</span>
<span class="sd">        Numpy symmetric array with distances between locations</span>
<span class="sd">    cost_fn : function  </span>
<span class="sd">        A function that returns a distance from a binary string</span>
<span class="sd">    print_results: bool</span>
<span class="sd">        If true prints out the hot start data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    hot_start_list: list</span>
<span class="sd">        A list of integers showing an estimate of the lowest cycle</span>
<span class="sd">    hot_start_distance: float</span>
<span class="sd">        The distance of the hot start cycle</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hot_start_list</span> <span class="o">=</span> <span class="n">hot_start</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> <span class="n">distance_array</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">bin_hot_start_list</span> <span class="o">=</span>  <span class="n">hot_start_list_to_string</span><span class="p">(</span><span class="n">sdl</span><span class="p">,</span> <span class="n">hot_start_list</span><span class="p">)</span>
    <span class="n">hot_start_distance</span> <span class="o">=</span> <span class="n">cost_fn</span><span class="p">(</span><span class="n">bin_hot_start_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The hot start location list is </span><span class="si">{</span><span class="n">hot_start_list</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;This is equivalent to a binary list: </span><span class="si">{</span><span class="n">bin_hot_start_list</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The hot start distance is </span><span class="si">{</span><span class="n">hot_start_distance</span><span class="si">}</span><span class="s1">, compared to a best distance of </span><span class="si">{</span><span class="n">sdl</span><span class="o">.</span><span class="n">best_dist</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bin_hot_start_list</span><span class="p">,</span> <span class="n">hot_start_distance</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Daniel Goldsmitih.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>